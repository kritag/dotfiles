- defaults:
    link:
      relink: true
      create: true
      force: true
- link:
    ~/.config/hypr/hyprland.conf: config/hyprland/hyprland-workstation.conf
    ~/.config/hypr/hyprlock.conf: config/hyprlock/hyprlock.conf
    ~/.config/k9s/config.yaml: config/k9s/config.yaml
    ~/.config/spotify-launcher.conf: config/spotify-launcher/spotify-launcher.conf
    ~/.functions_k8s: zsh/functions_k8s.zsh
    ~/.config/hypr/env.conf: config/hypr-workstation/env-workstation.conf
    ~/.config/uwsm/env: config/uwsm/env
    ~/.config/uwsm/default-id: config/uwsm/default-id
    ~/.config/user-dirs.dirs: config/user-dirs.dirs
    ~/.face: ./config/face
    ~/.config/mpv:
      glob: true
      force: true
      path: config/mpv/*
    ~/.config/btop:
      glob: true
      force: true
      path: config/btop/*
    ~/.config/kitty:
      glob: true
      force: true
      path: config/kitty/*
    ~/.local/share/fonts:
      glob: true
      path: fonts/*
    ~/.config/spicetify/Themes:
      glob: true
      force: true
      path: config/spicetify/Themes/*
    ~/.config/hypr/:
      create: true
      glob: true
      path: config/hypr/*
    ~/.config/flavours/:
      create: true
      glob: true
      path: config/flavours/*
- shell:
    - [systemctl --user enable gcr-ssh-agent.socket]
    # - [~/.dotfiles/pkgbuilds/install-all.sh, "Install all gtk themes and icons"]
    #     - [fc-cache -fv]
- sudo:
    - link:
        /usr/local/bin/pwquality.sh: scripts/pwquality.sh
        /usr/local/bin/fzf-preview.sh: scripts/fzf-preview.sh
    - shell:
        - [systemctl enable paccache.timer --now, "Enable deletion of cached pacman packages"]
        - [install -d -m 0755 /etc/systemd/logind.conf.d && install -m 0644 services/10-lid.conf /etc/systemd/logind.conf.d/10-lid.conf, "Configure systemd-logind lid behavior (ignore lid on external power)"]
        - [install -d -m 0755 /etc/systemd/journald.conf.d && install -m 0644 services/10-journald-retention.conf /etc/systemd/journald.conf.d/10-journald-retention.conf, "Configure systemd-journald log rotation"]
        - ["sed -i 's/^#\\?\\s*deny\\s*=.*/deny = 0/' /etc/security/faillock.conf", "Set faillock deny = 0"]
        - [install -D -m 0644 services/reflector.conf /etc/xdg/reflector/reflector.conf && systemctl enable reflector.timer --now, "Configure reflector and schedule mirror refresh"]
        - ["sed -i -e 's/^#\\s*LogFile/LogFile/' -e 's/^#\\s*Color/Color/' -e 's/^#\\s*ParallelDownloads/ParallelDownloads/' -e 's/^#\\s*ILoveCandy/ILoveCandy/' -e '/^#\\s*\\[multilib\\]/,/^#\\s*Include/s/^#\\s*//' /etc/pacman.conf", "Configure pacman defaults and enable multilib"]
        - ["sed -i 's/^#\\?MAKEFLAGS=.*/MAKEFLAGS=\"-j16\"/' /etc/makepkg.conf", "Enable parallel makepkg builds"]
        - ["sed -i -e 's/^#\\s*DefaultTimeoutStopSec=.*/DefaultTimeoutStopSec=15s/' -e 's/^DefaultTimeoutStopSec=.*/DefaultTimeoutStopSec=15s/' /etc/systemd/system.conf", "Reduce systemd shutdown timeout to 15 seconds"]
        - [systemctl enable fstrim.timer --now]
        - [systemctl enable systemd-oomd --now]
        - [systemctl enable --now btrfs-scrub@mnt-storage.timer]
        - [systemctl enable --now btrfs-scrub@-.timer]
        - [systemctl enable --now grub-btrfsd.service]
